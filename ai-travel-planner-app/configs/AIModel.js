const {
    GoogleGenerativeAI,
    HarmCategory,
    HarmBlockThreshold,
  } = require("@google/generative-ai");
  
  const apiKey = process.env.EXPO_PUBLIC_GOOGLE_GEMINI_API_KEY;

// Check if API key is available
if (!apiKey) {
  console.warn('Google Gemini API key not found. Please add EXPO_PUBLIC_GOOGLE_GEMINI_API_KEY to your .env file');
}

const genAI = apiKey ? new GoogleGenerativeAI(apiKey) : null;
  
  const model = genAI ? genAI.getGenerativeModel({
  model: "gemini-2.0-flash",
}) : null;

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 40,
  maxOutputTokens: 8192,
  responseMimeType: "application/json",
};

 
export const chatSession = model ? model.startChat({
  generationConfig,
      history: [
        {
            role: "user",
            parts: [
              {text: "Generate travel plan for location:Agra, India, 3 days and 2 night for Solo Traveler with a Luxury budget with flight details, flight price with booking url, Hotels option list with HotelName, Hotel Address, price, hotel image url,gei cordinates, rating, descriptions and place to visit nearby with place name, place details, place image url, geo cordinates, ticket pricing,Time to travel each of the location for 3 days and 2 night with each day plan with best time to visit in JSON\n"},
            ],
          },
          {
            role: "model",
            parts: [
              {text: "Okay, here's a detailed 3-day/2-night luxury travel plan for Agra, India, tailored for a solo traveler, presented in JSON format. This plan includes flight details (with dummy data as real-time pricing changes constantly), luxury hotel options, and a carefully curated itinerary with places to visit, timings, estimated costs, and travel times.\n\n```json\n{\n  \"tripName\": \"Luxury Agra Solo Getaway\",\n  \"destination\": \"Agra, India\",\n  \"duration\": \"3 Days / 2 Nights\",\n  \"travelerType\": \"Solo\",\n  \"budget\": \"Luxury\",\n  \"flights\": {\n    \"departure\": {\n      \"airline\": \"Emirates\",\n      \"flightNumber\": \"EK520\",\n      \"origin\": \"Your Origin City Code (e.g., JFK)\",\n      \"destination\": \"DEL (Delhi, then transfer to Agra)\",\n      \"departureTime\": \"10:00 AM\",\n      \"arrivalTime\": \"08:00 AM (+1 day) - Includes layover\",\n      \"flightPrice\": 1200,\n      \"currency\": \"USD\",\n      \"bookingUrl\": \"https://www.exampleflightbooking.com\"  // Replace with actual booking site\n    },\n    \"return\": {\n      \"airline\": \"Emirates\",\n      \"flightNumber\": \"EK519\",\n      \"origin\": \"DEL\",\n      \"destination\": \"Your Origin City Code (e.g., JFK)\",\n      \"departureTime\": \"09:00 PM\",\n      \"arrivalTime\": \"06:00 AM (+1 day) - Includes layover\",\n      \"flightPrice\": 1100,\n      \"currency\": \"USD\",\n      \"bookingUrl\": \"https://www.exampleflightbooking.com\" // Replace with actual booking site\n    },\n     \"transportToAgra\":{\n       \"mode\": \"Taxi\",\n       \"travelTime\": \"3-4 hours (from Delhi Airport to Agra)\",\n       \"price\": 80,\n       \"currency\": \"USD\"\n    }\n  },\n  \"hotels\": [\n    {\n      \"hotelName\": \"The Oberoi Amarvilas, Agra\",\n      \"address\": \"Taj East Gate Road, Agra, Uttar Pradesh 282001, India\",\n      \"price\": 600,\n      \"currency\": \"USD\",\n      \"imageUrl\": \"https://example.com/oberoi_amarvilas.jpg\", // Replace with actual image URL\n      \"geoCoordinates\": {\n        \"latitude\": 27.1755,\n        \"longitude\": 78.0504\n      },\n      \"rating\": 5,\n      \"description\": \"Offering unparalleled views of the Taj Mahal from every room, this luxurious hotel provides world-class service, exquisite dining, and a serene spa.\",\n      \"nearbyPlaces\": [\n        {\n          \"placeName\": \"Taj Mahal\",\n          \"distance\": \"Walking distance\"\n        }\n      ]\n    },\n    {\n      \"hotelName\": \"ITC Mughal, A Luxury Collection Hotel, Agra\",\n      \"address\": \"Taj Ganj, Agra, Uttar Pradesh 282001, India\",\n      \"price\": 450,\n      \"currency\": \"USD\",\n      \"imageUrl\": \"https://example.com/itc_mughal.jpg\", // Replace with actual image URL\n      \"geoCoordinates\": {\n        \"latitude\": 27.1714,\n        \"longitude\": 78.0417\n      },\n      \"rating\": 5,\n      \"description\": \"Spread over 35 acres of luxurious gardens, this hotel offers a blend of Mughal architecture and modern amenities, with multiple dining options and a relaxing spa.\",\n      \"nearbyPlaces\": [\n        {\n          \"placeName\": \"Agra Fort\",\n          \"distance\": \"5 km\"\n        }\n      ]\n    }\n  ],\n  \"itinerary\": {\n    \"day1\": {\n      \"theme\": \"Taj Mahal & Mughal Grandeur\",\n      \"morning\": {\n        \"time\": \"6:00 AM - 9:00 AM\",\n        \"activity\": \"Visit the Taj Mahal at sunrise.  Hire a guide for a richer experience.\",\n        \"placeName\": \"Taj Mahal\",\n        \"placeDetails\": \"An ivory-white marble mausoleum on the south bank of the Yamuna river.  A UNESCO World Heritage Site and one of the New Seven Wonders of the World.\",\n        \"imageUrl\": \"https://example.com/taj_mahal.jpg\", // Replace with actual image URL\n        \"geoCoordinates\": {\n          \"latitude\": 27.1753,\n          \"longitude\": 78.0421\n        },\n        \"ticketPricing\": {\n          \"foreigner\": 1300,\n          \"indian\": 250,\n          \"currency\": \"INR\"\n        },\n        \"bestTimeToVisit\": \"Sunrise\",\n        \"travelTime\": \"5-10 minutes (from Oberoi Amarvilas)\"\n      },\n      \"afternoon\": {\n        \"time\": \"11:00 AM - 1:00 PM\",\n        \"activity\": \"Explore Agra Fort, a UNESCO World Heritage Site.\",\n        \"placeName\": \"Agra Fort\",\n        \"placeDetails\": \"A historical fort in the city of Agra. It was the main residence of the emperors of the Mughal Dynasty until 1638 when the capital was shifted from Agra to Delhi.\",\n        \"imageUrl\": \"https://example.com/agra_fort.jpg\", // Replace with actual image URL\n        \"geoCoordinates\": {\n          \"latitude\": 27.1797,\n          \"longitude\": 78.0231\n        },\n        \"ticketPricing\": {\n          \"foreigner\": 650,\n          \"indian\": 50,\n          \"currency\": \"INR\"\n        },\n        \"bestTimeToVisit\": \"Late morning/early afternoon\",\n        \"travelTime\": \"20-30 minutes (from Taj Mahal)\"\n      },\n      \"evening\": {\n        \"time\": \"7:00 PM - 9:00 PM\",\n        \"activity\": \"Enjoy a luxurious dinner at Peshawri (ITC Mughal) known for its North-West Frontier cuisine.\",\n        \"placeName\": \"Peshawri Restaurant\",\n        \"placeDetails\": \"Award-winning restaurant at ITC Mughal serving authentic North-West Frontier cuisine.\",\n        \"imageUrl\": \"https://example.com/peshawri.jpg\", // Replace with actual image URL\n        \"geoCoordinates\": {\n          \"latitude\": 27.1714,\n          \"longitude\": 78.0417\n        },\n        \"ticketPricing\": {\n          \"costForTwo\": 5000,\n          \"currency\": \"INR\"\n        },\n        \"bestTimeToVisit\": \"Dinner\",\n        \"travelTime\": \"5-10 minutes (from Agra Fort)\"\n      }\n    },\n    \"day2\": {\n      \"theme\": \"Beyond the Monuments\",\n      \"morning\": {\n        \"time\": \"9:00 AM - 11:00 AM\",\n        \"activity\": \"Visit Itmad-ud-Daulah's Tomb (Baby Taj).\",\n        \"placeName\": \"Itmad-ud-Daulah's Tomb\",\n        \"placeDetails\": \"A Mughal mausoleum often described as a 'jewel box'.  It is regarded as a draft of the Taj Mahal.\",\n        \"imageUrl\": \"https://example.com/itmad_ud_daulah.jpg\", // Replace with actual image URL\n        \"geoCoordinates\": {\n          \"latitude\": 27.2028,\n          \"longitude\": 78.0394\n        },\n        \"ticketPricing\": {\n          \"foreigner\": 310,\n          \"indian\": 30,\n          \"currency\": \"INR\"\n        },\n        \"bestTimeToVisit\": \"Morning\",\n        \"travelTime\": \"20 minutes (from ITC Mughal)\"\n      },\n      \"afternoon\": {\n        \"time\": \"12:00 PM - 2:00 PM\",\n        \"activity\": \"Explore Mehtab Bagh for a different perspective of the Taj Mahal across the Yamuna River.\",\n        \"placeName\": \"Mehtab Bagh\",\n        \"placeDetails\": \"A charbagh garden complex located directly across the Yamuna River from the Taj Mahal. It offers stunning views, especially at sunset.\",\n        \"imageUrl\": \"https://example.com/mehtab_bagh.jpg\", // Replace with actual image URL\n        \"geoCoordinates\": {\n          \"latitude\": 27.1861,\n          \"longitude\": 78.0386\n        },\n        \"ticketPricing\": {\n          \"indian\": 20,\n          \"foreigner\": 300,\n          \"currency\": \"INR\"\n        },\n        \"bestTimeToVisit\": \"Late afternoon/Sunset\",\n        \"travelTime\": \"15 minutes (from Itmad-ud-Daulah's Tomb)\"\n      },\n      \"evening\": {\n        \"time\": \"6:00 PM - 8:00 PM\",\n        \"activity\": \"Enjoy a Mughal-era themed dinner and cultural performance at Kalakriti Cultural & Convention Center.\",\n        \"placeName\": \"Kalakriti Cultural & Convention Center\",\n        \"placeDetails\": \"A cultural center showcasing Mughal art, crafts, and culture.  Features a live show 'Mohabbat-The Taj'.\",\n        \"imageUrl\": \"https://example.com/kalakriti.jpg\", // Replace with actual image URL\n        \"geoCoordinates\": {\n          \"latitude\": 27.1676,\n          \"longitude\": 78.0459\n        },\n        \"ticketPricing\": {\n          \"showTicket\": 1500,\n          \"currency\": \"INR\"\n        },\n        \"bestTimeToVisit\": \"Evening for the show\",\n        \"travelTime\": \"20 minutes (from Mehtab Bagh)\"\n      }\n    },\n    \"day3\": {\n      \"theme\": \"Shopping & Departure\",\n      \"morning\": {\n        \"time\": \"9:00 AM - 11:00 AM\",\n        \"activity\": \"Shopping for souvenirs: Visit Kinari Bazaar for handicrafts, marble products, and textiles.  Bargain respectfully.\",\n        \"placeName\": \"Kinari Bazaar\",\n        \"placeDetails\": \"A vibrant local market known for its wedding apparel, jewelry, handicrafts, and marble products.\",\n        \"imageUrl\": \"https://example.com/kinari_bazaar.jpg\", // Replace with actual image URL\n        \"geoCoordinates\": {\n          \"latitude\": 27.1767,\n          \"longitude\": 78.0217\n        },\n        \"ticketPricing\": {\n          \"entry\": \"Free\",\n          \"currency\": \"INR\"\n        },\n        \"bestTimeToVisit\": \"Morning\",\n        \"travelTime\": \"20 minutes (from your hotel)\"\n      },\n      \"afternoon\": {\n        \"time\": \"12:00 PM - 2:00 PM\",\n        \"activity\": \"Enjoy a final luxurious lunch at a rooftop restaurant with Taj Mahal views.\",\n        \"placeName\": \"Infini - The Sky Lounge\",\n        \"placeDetails\": \"Rooftop restaurant at The Gateway Hotel offering panoramic views of the Taj Mahal.\",\n        \"imageUrl\": \"https://example.com/infini.jpg\", // Replace with actual image URL\n        \"geoCoordinates\": {\n          \"latitude\": 27.1655,\n          \"longitude\": 78.0444\n        },\n        \"ticketPricing\": {\n          \"costForTwo\": 4000,\n          \"currency\": \"INR\"\n        },\n        \"bestTimeToVisit\": \"Lunch\",\n        \"travelTime\": \"15 minutes (from Kinari Bazaar)\"\n      },\n      \"evening\": {\n        \"time\": \"3:00 PM\",\n        \"activity\": \"Depart from Agra.  Transfer to Delhi Airport for your flight home (allow ample time for the drive).\",\n        \"placeName\": \"Delhi Airport (DEL)\",\n        \"placeDetails\": \"Indira Gandhi International Airport in Delhi.\",\n        \"imageUrl\": \"https://example.com/delhi_airport.jpg\", // Replace with actual image URL\n        \"geoCoordinates\": {\n          \"latitude\": 28.5562,\n          \"longitude\": 77.1003\n        },\n        \"ticketPricing\": {\n          \"taxiFare\": 3000,\n          \"currency\": \"INR\"\n        },\n        \"bestTimeToVisit\": \"N/A\",\n        \"travelTime\": \"3-4 hours (from Agra to Delhi Airport)\"\n      }\n    }\n  },\n  \"notes\": [\n    \"This is a suggested itinerary and can be customized to your preferences.\",\n    \"Remember to book flights and hotels in advance, especially during peak season.\",\n    \"Hire a reputable guide for the Taj Mahal and Agra Fort to enhance your experience.\",\n    \"Be aware of scams and touts, especially around tourist attractions.\",\n    \"Dress modestly when visiting religious sites.\",\n    \"Stay hydrated and protect yourself from the sun.\",\n    \"Bargain respectfully when shopping.\",\n    \"Arrange for a reliable taxi or car service for transportation.\"\n  ]\n}\n```\n\n**Key Improvements and Explanations:**\n\n*   **JSON Format:**  The entire structure is valid JSON, making it easy to parse and use in applications.\n*   **Flight Details:** Includes placeholders for flight numbers, times, and a booking URL.  *Crucially, I've added a separate section for the transport from Delhi airport to Agra, as most international flights will arrive in Delhi.*\n*   **Luxury Hotel Options:**  Provides two high-end hotel choices with descriptions, prices, image URLs, geo-coordinates, ratings, and nearby places.\n*   **Detailed Itinerary:**\n    *   **Day-by-Day Breakdown:**  Organized by day, theme, and time of day.\n    *   **Specific Activities:** Includes concrete activities for each time slot.\n    *   **Place Details:**  Provides a description of each place, an image URL (placeholder), geo-coordinates, and ticket pricing (where applicable).\n    *   **Best Time to Visit:**  Specifies the ideal time to visit each location.\n    *   **Travel Time:** Estimates the travel time between locations.\n*   **Currency:**  Specifies the currency for prices (USD and INR).\n*   **Notes:**  Includes important tips and reminders for the traveler.\n*   **Realistic Activities:** Includes activities like shopping and dining at specific, highly-rated restaurants.  Also includes a visit to Mehtab Bagh for the sunset view of the Taj.\n*   **Complete Information:** Each place has a name, description, image URL, coordinates, and ticket price (if applicable).\n\n**How to Use This JSON:**\n\n1.  **Copy and Paste:** Copy the entire JSON block.\n2.  **Use a JSON Parser:** Use a JSON parser in your programming language of choice (e.g., Python's `json` library, JavaScript's `JSON.parse()`) to load the data into a data structure.\n3.  **Access the Data:** Access the information using the keys in the JSON object (e.g., `data[\"hotels\"][0][\"hotelName\"]` to get the name of the first hotel).\n4.  **Populate Your Application:**  Use the data to populate your travel application, website, or generate a travel document.\n5.  **Replace Placeholders:**  *Important:* Replace the placeholder image URLs, flight booking URLs, and origin city codes with real values.  Get real-time flight pricing from flight search APIs.\n\n**Important Considerations:**\n\n*   **Real-Time Data:**  Flight prices and availability change constantly. Use a flight API to get real-time data.\n*   **Availability:** Hotel availability should also be checked in real time.\n*   **Customization:** This is a template. Tailor it to your specific interests and budget.  For example, if you're interested in Mughal history, you might want to spend more time at Agra Fort.\n*   **Safety:** Stay aware of your surroundings and take necessary safety precautions.\n*   **Visa Requirements:** Ensure you have the necessary visa to enter India.\n*   **Health:** Consult your doctor about recommended vaccinations and health precautions.\n*   **Transportation:** Pre-book a reliable taxi or car service for getting around Agra.\n*   **Bargaining:** Bargaining is common in Indian markets.  Be polite and respectful.\n*   **Respect Local Customs:** Dress modestly when visiting religious sites and be mindful of local customs.\n*   **Guides:** Consider hiring a local guide for a more in-depth experience of the Taj Mahal and other historical sites.\n\nThis detailed JSON provides a solid foundation for planning a luxurious solo trip to Agra. Remember to replace the placeholder data with real-time information and personalize the itinerary to your liking!\n"},
            ],
          },
      ],
    }) : null;
  
    // const result = await chatSession.sendMessage("INSERT_INPUT_HERE");
    // console.log(result.response.text());
  
  

// Helper function to check if AI is available
export const isAIAvailable = () => {
  return !!apiKey && !!chatSession;
};

// Helper function to send message with error handling
export const sendAIMessage = async (message) => {
  if (!chatSession) {
    throw new Error('AI service not available. Please check your API key configuration.');
  }
  
  try {
    const result = await chatSession.sendMessage(message);
    return result.response.text();
  } catch (error) {
    console.error('AI message error:', error);
    throw new Error('Failed to get AI response. Please try again.');
  }
};